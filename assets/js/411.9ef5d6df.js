(window.webpackJsonp=window.webpackJsonp||[]).push([[411],{731:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" Nginx")]),s._v(" "),t("h2",{attrs:{id:"_1-nginx配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx配置文件"}},[s._v("#")]),s._v(" 1.Nginx配置文件")]),s._v(" "),t("p",[s._v("一般来说Nginx都只是作为一个入口，"),t("strong",[s._v("连接外网到部署的微服务内网")]),s._v("。")]),s._v(" "),t("ul",[t("li",[s._v("首先客户端从外部直接访问一个域名/ip时，nginx会监听server块内server_name+listen，如果域名+端口匹配则会根据后续不同的url字段交给当前server块的不同location进行代理。")]),s._v(" "),t("li",[s._v("Nginx常常用来配置一个首页访问请求，整个流程："),t("strong",[s._v("外部域名—>Nginx内server块代理到GateWay网关—>网关从根据Nacos转发给对应的微服务")]),s._v("。")]),s._v(" "),t("li",[s._v("而"),t("font",{attrs:{color:"red"}},[t("strong",[s._v("进入首页后的页面跳转，对于一个前端页面而言通常是前端页面向Gateway网关发送请求")])]),s._v("。")],1),s._v(" "),t("li",[s._v("location块：\n"),t("ul",[t("li",[s._v("root：表示匹配的请求路径都去Nginx哪个文件夹下面找。")]),s._v(" "),t("li",[s._v("proxy_pass：表示所有请求都转发给哪个URL地址。")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20230515/image-20230321202521773.3d28aikw3wo0.webp",alt:"image-20230321202521773"}})]),s._v(" "),t("h2",{attrs:{id:"_2-下载安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-下载安装"}},[s._v("#")]),s._v(" 2.下载安装")]),s._v(" "),t("h3",{attrs:{id:"_2-1编译工具-原始安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1编译工具-原始安装包"}},[s._v("#")]),s._v(" 2.1编译工具+原始安装包")]),s._v(" "),t("ul",[t("li",[s._v("yum -y install gcc pcre-devel zlib-devel openssl openssl-devel安装C编译器依赖包")]),s._v(" "),t("li",[s._v("wget下载安装包")]),s._v(" "),t("li",[s._v("解压tar -zxvf nginx-1.16.1.tar.gz")]),s._v(" "),t("li",[s._v("cd nginx-1.16.1")]),s._v(" "),t("li",[s._v("./configure --prefix=/usr/local/nginx")]),s._v(" "),t("li",[s._v("make && make install")])]),s._v(" "),t("h3",{attrs:{id:"_2-2使用yum工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2使用yum工具"}},[s._v("#")]),s._v(" 2.2使用yum工具")]),s._v(" "),t("p",[s._v("直接使用命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("一键安装完成，使用下面命令"),t("strong",[s._v("启动和关闭")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start nginx //启动\nsystemctl stop nginx //关闭\nsystemctl restart nginx //刷新配置\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("因为是源工具自动安装，注意两点：")]),s._v(" "),t("ul",[t("li",[t("font",{attrs:{color:"red"}},[t("strong",[s._v("放前端打包文件的地址")])]),s._v("：/usr/share/nginx/html")],1),s._v(" "),t("li",[t("font",{attrs:{color:"red"}},[t("strong",[s._v("配置文件地址")])]),s._v("：/etc/nginx/nginx.conf")],1)]),s._v(" "),t("h2",{attrs:{id:"_3-nginx命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-nginx命令"}},[s._v("#")]),s._v(" 3.Nginx命令")]),s._v(" "),t("p",[s._v("执行命令"),t("strong",[s._v("要进入sbin目录")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./nginx -v查看版本号\n./nginx -t查看配置文件是否有问题\n\n./nginx 启动nginx\n./nginx -s stop 停止服务\n./nginx -s reload 重新启动nginx\n启动前关闭防火墙\nsystemctl stop firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("./表示linux的当前所在相对目录")]),s._v(" "),t("p",[s._v("/usr/local 表示绝对路径")]),s._v(" "),t("h2",{attrs:{id:"_4-nginx配置文件块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-nginx配置文件块"}},[s._v("#")]),s._v(" 4.Nginx配置文件块")]),s._v(" "),t("p",[s._v("①全局块②events③http(http全局块,server块)")]),s._v(" "),t("p",[s._v("部署静态资源：配置http的server块")]),s._v(" "),t("p",[s._v("反向代理：反向代理服务器为于用户与目标服务器之间，"),t("strong",[s._v("客户端不知道目标服务器的地址")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server{\n\tlisten 82;\n\tserver_name localhost;\n\tlocation/{\n\t proxy_pass http://192...    填入代理的目标url地址\n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("负载均衡：代理服务服务器可以转发给一组服务器，根据负载均衡算法发送请求")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("upstream targetserver{  定义一组服务器\n\tserver 192.168.138.101:8080;\n\tserver 192.168.138.101:8081;\n}\nserver{\n\tlisten 82;\n\tserver_name localhost;\n\tlocation/{\n\t proxy_pass http://targetserver;    \n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"_5-前端项目部署-配置代理目标服务器ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-前端项目部署-配置代理目标服务器ip"}},[s._v("#")]),s._v(" 5.前端项目部署，配置代理目标服务器ip")]),s._v(" "),t("p",[s._v("注意这里除了要配置代理到前端服务器的index.html之外，"),t("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[t("strong",[s._v("还需要配置匹配拼接的后端请求路径的代理(location ^~ /prod-api")])]),s._v("/)。这是因为前端服务器代码内发送的请求，即使后端服务器在同一台机器+vite配置了代理，"),t("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[t("strong",[s._v("也会重新走外部nginx")])]),s._v("，因为此时发送请求的主机+域名依旧是对应服务器的IP。")],1),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html/dist")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /api/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/api/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://192.168.138.101:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  后端ip地址\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"_6-docker部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-docker部署"}},[s._v("#")]),s._v(" 6.Docker部署")]),s._v(" "),t("p",[s._v("见gateway网关项目")])])}),[],!1,null,null,null);t.default=e.exports}}]);
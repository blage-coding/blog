(window.webpackJsonp=window.webpackJsonp||[]).push([[467],{787:function(a,s,t){"use strict";t.r(s);var e=t(4),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"部署配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署配置"}},[a._v("#")]),a._v(" 部署配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20230831/image.4u63tdfzy3a0.webp",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"_1-api-gateway-admin前后端分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-api-gateway-admin前后端分离"}},[a._v("#")]),a._v(" 1.Api-gateway-admin前后端分离")]),a._v(" "),s("h4",{attrs:{id:"后台vue3项目文件夹说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后台vue3项目文件夹说明"}},[a._v("#")]),a._v(" 后台vue3项目文件夹说明")]),a._v(" "),s("ul",[s("li",[a._v("views：存放vue页面")]),a._v(" "),s("li",[a._v("router：通过ts文件配置组件与路由绑定关系")]),a._v(" "),s("li",[a._v("components：组件层(整个页面宏观整体角度)，包括标题头，左侧菜单，标签显示，脚部")]),a._v(" "),s("li",[a._v("api：统一维护一个index.ts，"),s("strong",[a._v("vue页面中的调用API接口统一管理，包括请求API接口")])]),a._v(" "),s("li",[a._v("public：存放模板与数据，比如api查询伪造的mock json数据")])]),a._v(" "),s("h4",{attrs:{id:"mybatis-where-标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-where-标签"}},[a._v("#")]),a._v(" Mybatis<where>标签")]),a._v(" "),s("p",[a._v("Mybatis的<where>标签"),s("strong",[a._v("结合<if>标签")]),a._v("使用(替代1=1，"),s("strong",[a._v("优化过滤需要MySQL做")]),a._v("，减轻压力)：①子句开头为and或者or时，where标签会自动把它剔除。②至少一个if标签有内容才会插入where子句。")]),a._v(" "),s("p",[s("strong",[a._v("好处："),s("font",{attrs:{color:"red"}},[a._v("sql语句复用，涵盖指定条件查询和全表查询(查所有)两种查询情况，repository层不需要做null判断")]),a._v("。")],1)]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("where")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"data != null and data.systemId != ''\"")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("and")]),a._v(" system_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#{data.systemId}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"data != null and data.interfaceId != ''\"")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("and")]),a._v(" interface_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#{data.interfaceId}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("where")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"跨域与分页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域与分页"}},[a._v("#")]),a._v(" 跨域与分页")]),a._v(" "),s("p",[a._v("跨域：直接在controller类上注解**@CrossOrigin**")]),a._v(" "),s("p",[a._v("分页：封装OperationRequest和OperationResult类型，接收前端的分页请求。同时后端增加行计数方法，总记录数返回给前端。")]),a._v(" "),s("h2",{attrs:{id:"_2-nginx配置问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx配置问题"}},[a._v("#")]),a._v(" 2.Nginx配置问题")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("数据库远程连接权限")])])]),a._v(" "),s("p",[a._v("问题：SpringBoot配置文件application.yml中连接数据库配置文件的路径改为本机的ip之后启动项目报错，连接不上数据库。")]),a._v(" "),s("p",[a._v("解决：登录连接MySQL后，输入以下两条命令，"),s("strong",[a._v("允许远程连接权限，并重启MySQL服务。")])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("all")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'root'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'1234'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("with")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("option")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nflush "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("privileges")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("ul",[s("li",[a._v("Nginx更改配置生效")])]),a._v(" "),s("p",[a._v("问题：Nginx在Docker环境部署时，手动修改nginx.conf后，容器没有自动更新配置。")]),a._v(" "),s("p",[a._v("解决："),s("strong",[a._v("需要docker restart重启使配置生效")]),a._v("。或者exec进入容器内部reload重新加载配置。")]),a._v(" "),s("ul",[s("li",[a._v("Nginx.conf异常退出")])]),a._v(" "),s("p",[a._v("问题：Nginx.conf异常退出，导致出现两份配置文件产生备份的现象,下次再进行修改的时会提示错误。")]),a._v(" "),s("p",[a._v("解决：在conf文件内ls -a查看所有文件(交换文件是隐藏文件)，并rm删除交换文件。")]),a._v(" "),s("ul",[s("li",[a._v("Nginx配置上游服务器")])]),a._v(" "),s("p",[a._v("问题：在Nginx.conf中配置upstream代理服务器没有生效，访问Nginx后没有正确代理到上游服务器返回404")]),a._v(" "),s("p",[a._v('解决：upstream每个server都需要以分号;结尾，因此center从数据库查询到网关地址后UpstreamVO的每个代理服务器server都需要在后面加上";"')]),a._v(" "),s("ul",[s("li",[a._v("Linux和windos换行符")])]),a._v(" "),s("p",[a._v("问题：Linux系统下的换行符直接\\n，不需要再添加\\r，否则在Linux内打开文件会出现^M乱码。")]),a._v(" "),s("h2",{attrs:{id:"_3-docker部署配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker部署配置"}},[a._v("#")]),a._v(" 3.Docker部署配置")]),a._v(" "),s("h4",{attrs:{id:"api-gateway-engine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-gateway-engine"}},[a._v("#")]),a._v(" ☀️api-gateway-engine")]),a._v(" "),s("p",[a._v("①Dockerfile文件"),s("font",{attrs:{color:"red"}},[s("strong",[a._v("配置EVN PARAMS指定springBoot运行环境(yml配置文件)，JAVA_OPTS用于指定java运行环境，比如-Dport。EVN相当于在ENTRYPOINT的指令拼接外部所指定的运行环境")])]),a._v(",具体如下：")],1),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 基础镜像")]),a._v("\nFROM openjdk:8-jdk-alpine\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 作者")]),a._v("\nMAINTAINER  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"panhai"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 时区")]),a._v("\nENV "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PRC\nENV "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PARAMS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-snf")]),a._v(" /usr/share/zoneinfo/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TZ")]),a._v(" /etc/localtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TZ")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/timezone\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加应用")]),a._v("\nADD api-gateway-engine.jar /api-gateway-engine.jar\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 执行镜像")]),a._v("\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"sh"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java -jar '),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_OPTS")]),a._v(" /api-gateway-engine.jar "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PARAMS")]),a._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("②根据Dockerfile文件构建镜像：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" ./Dockerfile "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" api-gateway-engine:1.0.0 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("③运行容器，"),s("font",{attrs:{color:"red"}},[s("strong",[a._v("通过-e指定Dockerfile配置的外部运行环境参数")])]),a._v("，最终拼接到Dockerfile的指令当中：")],1),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8003")]),a._v(":8003 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7398")]),a._v(":7398 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PARAMS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\n    --sever.port=8003\n    --api-gateway.address=http://192.168.200.200:8080\n    --api-gateway.groupId=10001\n    --api-gateway.gatewayId=api-gateway-g4\n    --api-gateway.gatewayName=电商配送网关\n    --api-gateway.gatewayAddress=192.168.200.200:7398"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" api-gateway-engine2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" api-gateway-engine:1.0.0\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h4",{attrs:{id:"api-gateway-center"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-gateway-center"}},[a._v("#")]),a._v(" ☀️api-gateway-center")]),a._v(" "),s("p",[a._v("①Dockerfile文件：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 基础镜像")]),a._v("\nFROM openjdk:8-jdk-alpine\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 作者")]),a._v("\nMAINTAINER  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"panhai"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 时区")]),a._v("\nENV "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PRC\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-snf")]),a._v(" /usr/share/zoneinfo/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TZ")]),a._v(" /etc/localtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TZ")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/timezone\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加应用")]),a._v("\nADD api-gateway-center.jar /api-gateway-center.jar\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 执行镜像")]),a._v("\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-jar"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/api-gateway-center.jar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("②根据Dockerfile文件构建镜像：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" ./Dockerfile "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" api-gateway-center:1.0.5 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("③运行容器，并"),s("font",{attrs:{color:"red"}},[s("strong",[a._v("将容器内部SpringBoot程序的文件，挂载到Linux服务器外部的Nginx配置文件，同时添加监听器")])]),a._v("，具体如下：")],1),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/nginx/conf:/nginx/conf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/run/docker.sock:/var/run/docker.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" api-gateway-center "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" api-gateway-center:1.0.5 CP4-LISTEN:8080,fork,reuseaddr UNIX-CONNECT:/var/run/docker.sock TCP4-LISTEN:8080,fork,reuseaddr UNIX-CONNECT:/var/run/docker.sock\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"单机zookeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单机zookeeper"}},[a._v("#")]),a._v(" ☀️单机Zookeeper")]),a._v(" "),s("p",[a._v("①拉取zookeeper镜像:")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull docker.io/zookeeper:3.4.13\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("②在单机主机上建立挂载目录和zookeeper配置文件：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/zookeeper/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/zookeeper/data\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/local/zookeeper/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" zoo.cfg\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("③zoo.cfg配置信息：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/data/log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("autopurge.snapRetainCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("autopurge.purgeInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("maxClientCnxns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("60")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("④单机启动zk容器，容器内的zkServer.sh默认会"),s("strong",[a._v("读取/conf/zoo.cfg下的配置")]),a._v("，读取将数据目录和配置目录挂载到容器内的对应文件，并使用host网络模式--network host(用默认的bridge模式，会导致容器跨主机间通信失败)，"),s("font",{attrs:{color:"red"}},[s("strong",[a._v("此时只能通过宿主机Linux的IP(192.168.200.200:2181)访问zk")])])],1),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("host")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/zookeeper/data:/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/zookeeper/conf:/conf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" zookeeper2181 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" docker.io/zookeeper:3.4.13\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"nginx配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[a._v("#")]),a._v(" ☀️Nginx配置")]),a._v(" "),s("p",[a._v("①拉取最新Nginx镜像：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull nginx\t\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("②创建外部挂载的文件目录")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/nginx/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/nginx/log\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/nginx/html\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("③先第一遍运行nginx容器，将容器的nginx.conf文件和conf.d文件夹复制到宿主机")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9001")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" nginx:/etc/nginx/nginx.conf /usr/local/nginx/conf/nginx.conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" nginx:/etc/nginx/conf.d /usr/local/nginx/conf/conf.d\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" nginx:/usr/share/nginx/html /usr/local/nginx/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("④删除容器")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stop nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" nginx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("⑤真正运行Nginx容器，并挂载对应文件与文件夹")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8090")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/nginx/conf/nginx.conf:/etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/nginx/conf/conf.d:/etc/nginx/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/nginx/log:/var/log/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/nginx/html:/usr/share/nginx/html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" nginx:latest\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("⑥"),s("strong",[a._v("修改html内容或者conf配置文件后，需要重启容器才能生效")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" restart nginx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);
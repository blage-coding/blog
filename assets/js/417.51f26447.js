(window.webpackJsonp=window.webpackJsonp||[]).push([[417],{734:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"feign远程调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#feign远程调用"}},[t._v("#")]),t._v(" Feign远程调用")]),t._v(" "),s("p",[t._v("声明式http客户端，可以实现http请求发送。具有负载均衡功能，底层依赖于Ribbon")]),t._v(" "),s("h2",{attrs:{id:"_1-安装使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装使用"}},[t._v("#")]),t._v(" 1.安装使用")]),t._v(" "),s("ul",[s("li",[t._v("添加maven依赖")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("在启动类上开启注解功能@EnableFeignClients")]),t._v(" "),s("li",[t._v("声明一个接口，这个接口不用我们去实现，使用时直接自动注入使用")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FeignClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uservice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对应服务提供者的服务名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user/{id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("除此之外Feign可以自定义配置日志级别，显示http的请求和应答信息。")]),t._v(" "),s("h2",{attrs:{id:"_2-性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-性能优化"}},[t._v("#")]),t._v(" 2.性能优化")]),t._v(" "),s("ul",[s("li",[t._v("日志接别设置为Basic或者None")]),t._v(" "),s("li",[t._v("使用连接池代替默认的URLConnection(Apache HttpClient或者OKHttp)")])]),t._v(" "),s("h2",{attrs:{id:"_3-最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-最佳实践"}},[t._v("#")]),t._v(" 3.最佳实践")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("方式一：消费者发送FeignHttp请求和提供者controller的处理方法两者接口是一致的，那么可以统一给消费者的UserClient和提供者UserController提供统一接口去继承和实现。")]),t._v(" "),s("p",[t._v("问题：紧耦合，同时父接口参数映射不能被继承。")])]),t._v(" "),s("li",[s("p",[t._v("方式二：将FeignClient抽取为独立模块，把FeignClient、POJO、Feign默认配置都定义到一个项目中，供所有消费者使用，调用还是通过消费者调用。"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("消费者服务中仅仅保留order服务相关的代码，关于user的实体类、HttpClient的声明全部都抽取挪到一个项目或者模块")])]),t._v("。")],1),t._v(" "),s("p",[t._v("问题：当定义的FeignClient不在SpringBootApplication的扫描包范围时，这些FeignClient无法使用。有两种方式解决。")])])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableFeignClients")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("basePackages "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cn.itcast.feign.clients"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableFeignClients")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clients "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);
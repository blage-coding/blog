(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{663:function(t,s,a){"use strict";a.r(s);var n=a(4),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"lockå¹¶å‘é”åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockå¹¶å‘é”åŸç†"}},[t._v("#")]),t._v(" Lockå¹¶å‘é”åŸç†")]),t._v(" "),s("p",[t._v("æœ¬ç« ä¸»è¦ä»‹ç»ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Javaå¹¶å‘åŒ…ä¸­é”çš„æºç å®ç°")]),t._v(" "),s("li",[t._v("å¹¶å‘é”API")])]),t._v(" "),s("h2",{attrs:{id:"lockæ¥å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockæ¥å£"}},[t._v("#")]),t._v(" Lockæ¥å£")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th",[t._v("synchronizedå…³é”®å­—")]),t._v(" "),s("th",[t._v("Lockæ¥å£")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("è·å–/é‡Šæ”¾é”")]),t._v(" "),s("td",[t._v("éšå¼")]),t._v(" "),s("td",[t._v("æ˜¾ç¤ºç¼–ç¨‹å®ç°")])]),t._v(" "),s("tr",[s("td",[t._v("å¯é‡å…¥")]),t._v(" "),s("td",[t._v("æ”¯æŒ")]),t._v(" "),s("td",[t._v("ReentrantLockæ˜¾å¼é‡å…¥")])]),t._v(" "),s("tr",[s("td",[t._v("çµæ´»æ€§")]),t._v(" "),s("td",[t._v("å·®")]),t._v(" "),s("td",[t._v("æ”¯æŒä¸­æ–­è·å–é”ï¼Œè¶…æ—¶è·å–é”")])])])]),t._v(" "),s("p",[t._v("Lockå¸¸ç”¨çš„æ¥å£åŒ…æ‹¬ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("void lock()ï¼šè·å–é”ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("boolean tryLock()ï¼šå°è¯•éé˜»å¡è·å–é”ï¼Œç«‹å³è¿”å›ã€‚")])]),t._v(" "),s("li",[s("p",[s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("boolean tryLock(long time")])]),t._v(")ï¼šè¶…æ—¶é˜»å¡æ—¶è·å–é”ã€‚ä»…å½“â‘ è¶…æ—¶é—´å†…è·å–åˆ°é”â‘¡è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­â‘¢åˆ°è¾¾è¶…æ—¶æ—¶é—´ä¸‰ç§æƒ…å†µä¸‹ä¼šè¿”å›ã€‚")],1)])]),t._v(" "),s("h2",{attrs:{id:"é˜Ÿåˆ—åŒæ­¥å™¨aqs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é˜Ÿåˆ—åŒæ­¥å™¨aqs"}},[t._v("#")]),t._v(" é˜Ÿåˆ—åŒæ­¥å™¨AQS")]),t._v(" "),s("h3",{attrs:{id:"æ¨¡æ¿æ¥å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¨¡æ¿æ¥å£"}},[t._v("#")]),t._v(" æ¨¡æ¿æ¥å£")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("åŒæ­¥çŠ¶æ€")]),t._v(" "),s("p",[t._v("åŒæ­¥çŠ¶æ€å¯ä»¥ç†è§£ä¸ºåŒæ­¥å™¨çš„é”èµ„æºï¼Œå¤šçº¿ç¨‹ç«äº‰Lockçš„é”èµ„æºå®é™…ä¸Šæ˜¯åœ¨ç«äº‰AQSçš„â€œåŒæ­¥çŠ¶æ€â€ã€‚")]),t._v(" "),s("p",[t._v("ç”¨ä¸€ä¸ªintæ•´æ•°å­˜å‚¨è¡¨ç¤ºï¼Œè¯­ä¹‰ä¸Šå¯ä»¥ç†è§£ä¸ºé”èµ„æºçš„å¤§å°ã€å…è®¸çš„å¹¶å‘åº¦ã€‚")])]),t._v(" "),s("p",[t._v("AbstractQueuedSynchronizer(AQS)åŒæ­¥å™¨æä¾›äº†ä¸‰ä¸ªå¯¹â€œåŒæ­¥çŠ¶æ€â€æ“ä½œçš„åŸå­æ–¹æ³•å’ŒæŸ¥çœ‹é”å æœ‰çº¿ç¨‹çš„APIï¼š")]),t._v(" "),s("ul",[s("li",[t._v("getState()ï¼šè·å–å½“å‰åŒæ­¥çŠ¶æ€")]),t._v(" "),s("li",[t._v("setState(int newState)ï¼šè®¾ç½®å½“å‰åŒæ­¥çŠ¶æ€")]),t._v(" "),s("li",[t._v("compareAndSetState(int current , int update)ï¼šCASæ›´æ–°å½“å‰çŠ¶æ€ã€‚å…¶ä¸­currentè¡¨ç¤ºå½“å‰getStateç»“æœã€‚")]),t._v(" "),s("li",[s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("getExclusiveOwnerThread")])]),t._v("ï¼šè¿”å›å½“å‰ç‹¬å é”çš„çº¿ç¨‹ã€‚")],1),t._v(" "),s("li",[s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("setExclusiveOwnerThread")])]),t._v("(thread)ï¼šè®¾ç½®å½“å‰å æœ‰é”çš„çº¿ç¨‹ã€‚")],1)]),t._v(" "),s("p",[t._v("AQSæŠ½è±¡ç±»ä¸»è¦é¢å‘é”çš„å¼€å‘è€…ï¼ŒåŸºäºæ¨¡æ¿æ¨¡å¼ï¼Œæ‰€æä¾›çš„æ–¹æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¯é‡å†™æ–¹æ³•ï¼šåŒ…æ‹¬tryAcquire(),tryRelease()ç­‰ã€‚"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("åŸºäºä¸Šè¿°ä¸‰ä¸ªåŸå­æ“ä½œå¯¹é”èµ„æºè¿›è¡Œæ“ä½œ")])]),t._v("ã€‚")],1),t._v(" "),s("li",[t._v("æ¨¡æ¿æ–¹æ³•ï¼šåŒæ­¥å™¨å®šä¹‰å¥½å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼ŒåŒ…æ‹¬acquire(),release()...æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä¸Šé¢é‡å†™çš„æ–¹æ³•ã€‚")])]),t._v(" "),s("p",[s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("å®ç°çš„é”æ¥å£æ–¹æ³•ä¸­ï¼Œéœ€è¦è°ƒç”¨AQSæ¨¡æ¿æ–¹æ³•å®ç°åŒæ­¥")])]),t._v("ã€‚åŸºäºåŒæ­¥å™¨æ¡†æ¶å¯ä»¥å®ç°"),s("strong",[t._v("åŒæ­¥ç»„ä»¶")]),t._v("ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š")],1),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mutex")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" åŒæ­¥å™¨ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//é‡å†™åŒæ­¥å™¨æ–¹æ³•")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" acquires"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" sync"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¤–éƒ¨æš´éœ²çš„é”æ–¹æ³•ã€‚å®é™…ä¸Šéƒ½é€šè¿‡è°ƒç”¨ä¸Šè¿°ä»£ç†çš„åŒæ­¥å™¨å¯¹è±¡çš„æ–¹æ³•å®ç°")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sync "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("æ˜¾ç„¶ç”¨æˆ·åœ¨ä½¿ç”¨Locké”å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¼šç›´æ¥å’ŒåŒæ­¥å™¨æ‰“äº¤é“ã€‚"),s("strong",[t._v("é”Lockè´Ÿè´£ä¸ç”¨æˆ·äº¤äº’ä½¿ç”¨ï¼Œè€Œåº•å±‚ä»£ç å®é™…ä¸Šæ˜¯åŸºäºåŒæ­¥å™¨æ¡†æ¶å®ç°çš„")]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"åŒæ­¥å™¨aqsæºç å®ç°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŒæ­¥å™¨aqsæºç å®ç°"}},[t._v("#")]),t._v(" åŒæ­¥å™¨AQSæºç å®ç°")]),t._v(" "),s("p",[t._v("åœ¨AQSä¸åŒæ–¹æ³•ä¸­ï¼Œæ‰€è°“æ­»å¾ªç¯â€œè‡ªæ—‹â€åˆ†æˆä»¥ä¸‹ä¸¤ç§ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¨¡æ¿æ–¹æ³•ï¼šä¸æ–­æ‰§è¡Œtryæ–¹æ³•å°è¯•è·å–é”ï¼Œæ ¹æ®tryæ–¹æ³•æ‰èƒ½é€€å‡ºæ­»å¾ªç¯")]),t._v(" "),s("li",[t._v("é‡å†™çš„tryæ–¹æ³•ï¼šé”å¯ä»¥è·å–çš„æƒ…å†µä¸‹é‡å¤æ‰§è¡ŒCASæ–¹æ³•ï¼Œç›´åˆ°æˆåŠŸä¿®æ”¹åŒæ­¥çŠ¶æ€ä½ã€‚æ— é”çŠ¶æ€åˆ™ä¸éœ€è¦è‡ªæ—‹ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"_1-åŒæ­¥é˜Ÿåˆ—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŒæ­¥é˜Ÿåˆ—"}},[t._v("#")]),t._v(" 1.åŒæ­¥é˜Ÿåˆ—")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20231015/image.6r0xj8ievl4.webp",alt:""}})]),t._v(" "),s("p",[t._v("å†…éƒ¨ä¾èµ–äºè‡ªå®šä¹‰çš„Nodeæ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªFIFO"),s("strong",[t._v("åŒå‘åŒæ­¥é˜Ÿåˆ—")]),t._v("ï¼Œä¿å­˜çš„èŠ‚ç‚¹æ˜¯"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹å¼•ç”¨")])]),t._v("ã€‚")],1),t._v(" "),s("p",[t._v("åŒæ­¥å™¨å†…ç»´æŠ¤é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ã€‚é˜Ÿé¦–nodeèŠ‚ç‚¹æˆåŠŸè·å–åˆ°åŒæ­¥çŠ¶æ€åå‡ºé˜Ÿï¼Œå¹¶æ›´æ–°åŒæ­¥å™¨çš„å¤´èŠ‚ç‚¹ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("é˜Ÿé¦–å…ƒç´ æ›´æ–°ä¸éœ€è¦CASï¼Œå› ä¸ºåªä¼šæœ‰ä¸€ä¸ªå…ƒç´ èƒ½å¤Ÿè·å–åŒæ­¥çŠ¶æ€ã€‚")]),t._v(" "),s("li",[t._v("é˜Ÿå°¾å…ƒç´ æ’å…¥æ›´æ–°éœ€è¦æ‹¿åˆ°CASï¼Œå› ä¸ºåŒæ—¶ä¼šæœ‰å¤šä¸ªå…ƒç´ åŒæ—¶ç«äº‰è·å–åŒæ­¥çŠ¶æ€ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"_2-ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"}},[t._v("#")]),t._v(" 2.ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾")]),t._v(" "),s("p",[t._v("ç‹¬å å¼ï¼š"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹")])]),t._v("æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ã€‚é€šè¿‡åŒæ­¥å™¨çš„"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("acquire")])]),t._v("åŸç”Ÿæ–¹æ³•å®ç°ï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š")],1),t._v(" "),s("ol",[s("li",[t._v("æ‰§è¡Œé‡å†™çš„åŒæ­¥å™¨æ–¹æ³•"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("tryAcquire")])]),t._v("()ï¼Œè‹¥è·å–å¤±è´¥åˆ™æ‰§è¡Œä¸‹é¢æ­¥éª¤ã€‚")],1),t._v(" "),s("li",[t._v("æ„é€ åŒæ­¥èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡CASåŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚")]),t._v(" "),s("li",[t._v("èŠ‚ç‚¹è°ƒç”¨"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("acquireQueued")])]),t._v("ï¼Œè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼Œä»¥æ­»å¾ªç¯+é˜»å¡çš„æ–¹å¼å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚åªæœ‰å‰é©±æ˜¯å¤´èŠ‚ç‚¹çš„èŠ‚ç‚¹æ‰ä¼šå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œä»è€Œä¿è¯FIFOçš„é˜Ÿåˆ—ç‰¹æ€§ã€‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µè¢«å”¤é†’ï¼š\n"),s("ul",[s("li",[t._v("å‰é©±èŠ‚ç‚¹å‡ºé˜Ÿåˆ—")]),t._v(" "),s("li",[t._v("é˜»å¡çº¿ç¨‹è¢«ä¸­æ–­")])])],1)]),t._v(" "),s("p",[t._v("çº¿ç¨‹acquireæ‹¿åˆ°é”ï¼Œå¹¶è¿”å›æ‰§è¡Œå®Œç›¸åº”é€»è¾‘åï¼Œéœ€è¦é‡Šæ”¾åŒæ­¥çŠ¶æ€å¹¶å”¤é†’åç»§èŠ‚ç‚¹ã€‚")]),t._v(" "),s("h4",{attrs:{id:"_3-å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"}},[t._v("#")]),t._v(" 3.å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾")]),t._v(" "),s("p",[t._v("å…±äº«å¼ï¼š"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹")])]),t._v("åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚é€šè¿‡åŒæ­¥å™¨çš„"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("acquireShared")])]),t._v("åŸç”Ÿæ–¹æ³•å®ç°ã€‚")],1),t._v(" "),s("p",[s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("å…±äº«å¼å’Œç‹¬å å¼ä¸€æ ·ï¼Œå¦‚æœé”è·å–å¤±è´¥ï¼Œéƒ½ä¼šæ­»å¾ªç¯è‡ªæ—‹ä¸æ–­å°è¯•è·å–åŒæ­¥çŠ¶æ€")])]),t._v("ã€‚åŒºåˆ«åœ¨äºï¼Œå…±äº«å¼é€€å‡ºè‡ªæ—‹çš„æ¡ä»¶å˜ä¸ºp.prev==head&&tryAcquireShared()>=0ï¼Œé‡å†™æ–¹æ³•tryAcè¿”å›å€¼å¤§äºç­‰äº0è¡¨ç¤ºèƒ½å¤Ÿè·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚")],1),t._v(" "),s("p",[t._v("â€œåŒæ­¥çŠ¶æ€â€é‡Šæ”¾æ—¶ï¼Œ"),s("strong",[t._v("ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶é‡Šæ”¾é”ï¼Œå› æ­¤éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨")]),t._v("ã€‚(ç‹¬å å¼æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ï¼Œä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨)")]),t._v(" "),s("h4",{attrs:{id:"_4-ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€"}},[t._v("#")]),t._v(" 4.ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€")]),t._v(" "),s("p",[t._v("åŒæ­¥å™¨åŸç”Ÿæ–¹æ³•"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("doAcquireNanos")])]),t._v("ï¼šæ ¸å¿ƒé€»è¾‘ä¸ç‹¬å å¼å’Œå…±äº«å¼ç±»ä¼¼ã€‚åŒºåˆ«åœ¨äºåœ¨è‡ªæ—‹çŠ¶æ€ä¸­ï¼Œ"),s("strong",[t._v("æ¯è½®å¾ªç¯ä¼šè®¡ç®—ä¸€æ¬¡ç»è¿‡çš„æ—¶é—´é—´éš”ï¼Œå¹¶ä»è¶…æ—¶æ—¶é—´nanosTimeouté‡Œé¢æ‰£å‡")]),t._v("ã€‚å¦‚æœå½“å‰è¶…æ—¶æ—¶é—´è¢«æ‰£å‡åˆ°å°äº0ï¼Œåˆ™è¯´æ˜å½“å‰è¶…æ—¶ï¼Œç›´æ¥è¿”å›é€€å‡ºã€‚")],1),t._v(" "),s("p",[t._v("è‹¥æ—¶é—´nanosTimeoutæ¯”è¾ƒçŸ­ï¼Œåˆ™è¿›å…¥æ— æ¡ä»¶çš„å¿«é€Ÿè‡ªæ—‹ã€‚")]),t._v(" "),s("h3",{attrs:{id:"æ¡ˆä¾‹-è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹-è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶"}},[t._v("#")]),t._v(" æ¡ˆä¾‹â€”â€”è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶")]),t._v(" "),s("p",[t._v("åŠŸèƒ½ï¼šåŒä¸€æ—¶åˆ»ï¼Œåªå…è®¸è‡³å¤šä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚è¶…è¿‡ä¸¤ä¸ªçº¿ç¨‹çš„è®¿é—®å°†ä¼šè¢«é˜»å¡ã€‚")]),t._v(" "),s("p",[t._v("åŸºäºä¸Šè¿°APIå’Œæ¥å£ï¼Œé‡‡ç”¨å…±äº«æ¨¡å¼å®ç°å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyLock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractQueuedSynchronizer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IllegalArgumentException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"count must larger than zero"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è¿”å›æ›´æ–°åçš„åŒæ­¥çŠ¶æ€å€¼ï¼Œå°äº0åˆ™è¡¨ç¤ºè·å–å¤±è´¥")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquireShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" reduceCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" newState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" reduceCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ‰£å‡å¤±è´¥ï¼Œè¿”å›å°äº0çš„åŒæ­¥çŠ¶æ€ç»“æœ")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" newState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¤§äº0ï¼Œåˆ™æ‰§è¡ŒCASæˆåŠŸåæ‰è¿›è¡Œæ‰£å‡")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" newState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryReleaseShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" returnCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" newState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" returnCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" sync "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("releaseShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br")])]),s("h2",{attrs:{id:"reentrantlocké‡å…¥é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlocké‡å…¥é”"}},[t._v("#")]),t._v(" ReentrantLocké‡å…¥é”")]),t._v(" "),s("p",[t._v("ReentrantLocké”ä¸»è¦åŒ…å«å¦‚ä¸‹ç‰¹æ€§ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ReentrantLockæ˜¯ä¸€ä¸ªç‹¬å é”(æ’ä»–é”)ï¼Œä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰é”ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ReentrantLockçš„"),s("strong",[t._v("åŒæ­¥çŠ¶æ€state")]),t._v("è¯­ä¹‰ä¸Šç›¸å½“äºä¸€ä¸ª"),s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("è®¡æ•°å™¨ï¼Œä»£è¡¨å½“å‰å æœ‰é”çš„çº¿ç¨‹é‡å…¥çš„æ¬¡æ•°")])]),t._v("ã€‚")],1),t._v(" "),s("ul",[s("li",[t._v("state=0ï¼šä»£è¡¨å½“å‰é”æ²¡æœ‰çº¿ç¨‹å ç”¨ï¼Œä»»ä½•çº¿ç¨‹å¯ä»¥è·å–é”ï¼Œ"),s("strong",[t._v("éœ€è¦CASæŠ¢å é”")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("state=nï¼šä»£è¡¨é”è¢«æŸä¸ªçº¿ç¨‹é‡å…¥äº†næ¬¡ã€‚")])])]),t._v(" "),s("li",[s("p",[t._v("é‡å…¥æ€§ï¼šå æœ‰é”çš„çº¿ç¨‹æ”¯æŒå†æ¬¡è°ƒç”¨lockæ–¹æ³•ï¼Œ"),s("strong",[t._v("é‡æ–°è·å–é”è¿›å…¥åŒæ­¥å—")]),t._v("ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å…¬å¹³æ€§ï¼šå…ˆç”³è¯·è·å–é”çš„è¯·æ±‚ä¼˜å…ˆè¢«æ»¡è¶³ï¼Œè·å–é”çš„è¿‡ç¨‹æ˜¯é¡ºåºçš„ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"_1-é‡å…¥æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-é‡å…¥æ€§"}},[t._v("#")]),t._v(" 1.é‡å…¥æ€§")]),t._v(" "),s("p",[t._v("é‡å…¥æ€§å®ç°æ ¸å¿ƒæ˜¯é€šè¿‡getExclusiveOwnerThreadåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºå æœ‰é”çš„çº¿ç¨‹ï¼Œåˆ†ä¸ºè·å–å’Œé‡Šæ”¾ä¸¤éƒ¨åˆ†ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è·å–é”é€»è¾‘ï¼šé¦–å…ˆåˆ¤æ–­å½“å‰åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœä¸º0åˆ™ç›´æ¥æŠ¢å é”ï¼›è‹¥å¤§äºé›¶ï¼Œåˆ™åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºå ç”¨é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œ"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("ç´¯åŠ åŒæ­¥çŠ¶æ€è®¡æ•°å™¨")])]),t._v("ã€‚")],1),t._v(" "),s("li",[t._v("é‡Šæ”¾é”é€»è¾‘ï¼š"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("åŒæ­¥çŠ¶æ€è®¡æ•°å™¨æ‰£å‡å½“å‰é‡Šæ”¾çº¿ç¨‹æ•°")])]),t._v("ï¼Œå½“ä¸”ä»…å½“åŒæ­¥çŠ¶æ€å‡åˆ°0æ‰ç®—çœŸæ­£çš„é‡Šæ”¾å®Œæ¯•ï¼Œå°†é”å æœ‰çº¿ç¨‹ç½®ä¸ºç©ºå¹¶è¿”å›trueã€‚")],1)]),t._v(" "),s("h3",{attrs:{id:"_2-å…¬å¹³é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å…¬å¹³é”"}},[t._v("#")]),t._v(" 2.å…¬å¹³é”")]),t._v(" "),s("p",[t._v("ReentrantLocké»˜è®¤å®ç°æ˜¯éå…¬å¹³é”ã€‚å…¬å¹³é”èƒ½å¤Ÿå®ç°"),s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("æŒ‰ç…§â€œè¯·æ±‚é¡ºåºâ€è·å–é”ï¼Œä¸AQSå†…éƒ¨é˜Ÿåˆ—é¡ºåºä¿æŒä¸€è‡´")])]),t._v("ã€‚")],1),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("å…¬å¹³é”è¯·æ±‚é¡ºåº")]),t._v(" "),s("p",[t._v("â€œè¯·æ±‚é¡ºåºâ€æ˜¯æŒ‡å¤šçº¿ç¨‹è°ƒç”¨tryAcquireçš„é¡ºåºï¼Œå®ƒä¸ç­‰äºAQSå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—çš„é¡ºåºï¼Œä¹Ÿä¸ç­‰äºä»£ç æ‰§è¡Œé¡ºåºã€‚")]),t._v(" "),s("p",[t._v("æ— è®ºæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥äº†ç­‰å¾…é˜Ÿåˆ—ï¼Œé‚£ä¹ˆéƒ½å¿…é¡»æŒ‰ç…§AQSå†…éƒ¨ç­‰å¾…é˜Ÿåˆ—çš„é¡ºåºæ‰§è¡Œã€‚")])]),t._v(" "),s("p",[t._v("å½“å‰å¯ä»¥è·å–é”æ—¶ï¼ŒCASæ“ä½œå¤šåŠ "),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("hasQueuedPredecessors()")])]),t._v("åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æœ‰å‰é©±èŠ‚ç‚¹è¿”å›trueï¼Œä¿è¯æ¯ä¸ªèƒ½å¤Ÿè·å–é”çš„ä¸€å®šæ˜¯å¤´ç»“ç‚¹ï¼Œ"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("æ²¡æœ‰æ’é˜Ÿçš„çº¿ç¨‹")])]),t._v("ã€‚")],1),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasQueuedPredecessors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("è€Œéå…¬å¹³é”ï¼ŒæŸä¸€ä¸ªæ—¶åˆ»è¿˜æ²¡åŠ å…¥ç­‰å¾…é˜Ÿåˆ—æ—¶tryacquireï¼Œå¦‚æœå½“å‰æ­£å¥½é”é‡Šæ”¾äº†å¯ä»¥è·å–åŒæ­¥çŠ¶æ€ï¼Œ"),s("strong",[t._v("é‚£ä¹ˆå½“å‰çº¿ç¨‹æ— éœ€åŠ å…¥ç­‰å¾…é˜Ÿåˆ—é˜»å¡")]),t._v("ï¼Œç›´æ¥æ‹¿é”è¿”å›ï¼ŒCPUæ— éœ€å”¤é†’å…¶å®ƒçº¿ç¨‹ã€‚")]),t._v(" "),s("h3",{attrs:{id:"_3-å…¬å¹³é”å’Œéå…¬å¹³é”å¯¹æ¯”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å…¬å¹³é”å’Œéå…¬å¹³é”å¯¹æ¯”"}},[t._v("#")]),t._v(" 3.å…¬å¹³é”å’Œéå…¬å¹³é”å¯¹æ¯”")]),t._v(" "),s("p",[t._v("ğŸ’¡å¯¹æ¯”å®éªŒéœ€è¦æ­»å¾ªç¯è°ƒç”¨è·å–é”ã€‚è‹¥æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆç»“æœæ¯«æ— æ„ä¹‰ï¼Œæ— æ³•åŒºåˆ†æ˜¯å¦å…¬å¹³ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("çº¿ç¨‹é¥¥é¥¿ç°è±¡")])]),t._v(" "),s("p",[t._v("éå…¬å¹³é”ä¸­ï¼Œåˆšé‡Šæ”¾å®Œé”çš„çº¿ç¨‹å³ä½¿å¤„äºé˜Ÿåˆ—å°¾éƒ¨ï¼Œä¹Ÿå¯èƒ½ä¼šç«‹åˆ»é‡æ–°è·å–åˆ°é”ï¼Œä»è€Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹ä¸€ç›´ä¸èƒ½è°ƒåº¦ï¼Œ"),s("strong",[t._v("å‡ºç°â€é¥¥é¥¿â€œçš„æƒ…å†µ")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("è€Œåœ¨å…¬å¹³é”ä¸­ï¼Œåˆšé‡Šæ”¾çš„é”æ’åœ¨é˜Ÿå°¾ï¼Œå¿…å®šä¸èƒ½ç«‹åˆ»é‡æ–°è·å–é”ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("ä¸Šä¸‹æ–‡å¼€é”€")])]),t._v(" "),s("p",[t._v("è™½ç„¶éå…¬å¹³é”ä¸èƒ½è°ƒåº¦ï¼Œä½†è¿ç»­ä¸¤æ¬¡çº¿ç¨‹è·å–åˆ°çº¿ç¨‹ï¼Œ"),s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("ä¸éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ï¼Œååå’Œæ•ˆç‡æ›´é«˜")])])],1),t._v(" "),s("p",[t._v("è€Œåè¿‡æ¥ï¼Œå…¬å¹³é”å®ç°FIFOçš„ä»£ä»·å°±æ˜¯ï¼Œè¿›è¡Œå¤§é‡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€å¤§ã€‚")]),t._v(" "),s("h2",{attrs:{id:"reentrantreadwritelockè¯»å†™é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelockè¯»å†™é”"}},[t._v("#")]),t._v(" ReentrantReadWriteLockè¯»å†™é”")]),t._v(" "),s("p",[t._v("è¯»é”å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå†™é”åˆ™åªå…è®¸ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸¤ç§å®ç°æ–¹å¼ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åŸºäºwait/notifyçš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œä½†æ˜¯ä»£ç ç¼–ç¨‹å¤æ‚")]),t._v(" "),s("li",[t._v("ReentrantReadWriteLockè¯»é”å’Œå†™é”ï¼Œç®€å•æ˜äº†ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"æ¥å£ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¥å£ç¤ºä¾‹"}},[t._v("#")]),t._v(" æ¥å£ç¤ºä¾‹")]),t._v(" "),s("p",[t._v("ReadWriteLockæä¾›çš„APIä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è·å–è¯»å†™é”ï¼š"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("readLock(),writeLock()")])]),t._v("ï¼Œè¿”å›Lockæ¥å£çš„å¼•ç”¨ï¼Œé€šè¿‡è°ƒç”¨è¯»å†™é”çš„lock,unlockæ–¹æ³•å®ç°è¯»å†™å¹¶å‘æ§åˆ¶ã€‚")],1),t._v(" "),s("li",[t._v("ç›‘æ§å†…éƒ¨è¯»å†™é”çŠ¶æ€çš„æ–¹æ³•ï¼šåŒ…æ‹¬"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("getReadLockCount()")])]),t._v(","),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("isWriteLocked()")])]),t._v("...è·å–è¯»é”æ¬¡æ•°ï¼Œå†™é”æ˜¯å¦è·å–ã€‚")],1)]),t._v(" "),s("h3",{attrs:{id:"æºç åˆ†æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æºç åˆ†æ"}},[t._v("#")]),t._v(" æºç åˆ†æ")]),t._v(" "),s("h4",{attrs:{id:"_1-è¯»å†™åŒæ­¥çŠ¶æ€åˆ’åˆ†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¯»å†™åŒæ­¥çŠ¶æ€åˆ’åˆ†"}},[t._v("#")]),t._v(" 1.è¯»å†™åŒæ­¥çŠ¶æ€åˆ’åˆ†")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20231017/image.2o8v7250k3a0.webp",alt:""}})]),t._v(" "),s("p",[t._v("å°†åŒæ­¥çŠ¶æ€æŒ‰ä½åˆ‡å‰²ï¼Œåˆ†åˆ«å­˜å‚¨â€œ"),s("strong",[t._v("è¯»é”â€çš„åŒæ­¥çŠ¶æ€")]),t._v("ï¼Œâ€œ"),s("strong",[t._v("å†™é”â€çš„åŒæ­¥çŠ¶æ€")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("å†™é”åŒæ­¥çŠ¶æ€ï¼šstate=0ä»£è¡¨å½“å‰æœªè·å–ï¼Œstate>0ä»£è¡¨çº¿ç¨‹"),s("strong",[t._v("é‡å…¥")]),t._v("çš„æ¬¡æ•°ã€‚")]),t._v(" "),s("li",[t._v("è¯»é”åŒæ­¥çŠ¶æ€ï¼šstateä½œä¸ºè®¡æ•°å™¨è®°å½•å½“å‰è·å–è¯»é”çš„çº¿ç¨‹æ•°ã€‚")])]),t._v(" "),s("p",[s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("getState>0ï¼Œå†™é”åŒæ­¥çŠ¶æ€ä¸º0ï¼Œé‚£ä¹ˆå¯ä»¥æ¨å‡ºä¸€å®šæœ‰è¯»é”åŒæ­¥çŠ¶æ€å¤§äº0ï¼Œå½“å‰å¤„äºè¯»çŠ¶æ€")])]),t._v("ã€‚")],1),t._v(" "),s("h4",{attrs:{id:"_2-å†™é”è·å–ä¸é‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†™é”è·å–ä¸é‡Šæ”¾"}},[t._v("#")]),t._v(" 2.å†™é”è·å–ä¸é‡Šæ”¾")]),t._v(" "),s("p",[t._v("å†™é”æŠ¢å è·å–é€»è¾‘å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¦‚æœè¯»å†™åŒæ­¥çŠ¶æ€å¤§äº0ï¼Œåˆ†åˆ«åˆ¤æ–­è¯»åŒæ­¥çŠ¶æ€å’Œå†™åŒæ­¥çŠ¶æ€ï¼š\n"),s("ul",[s("li",[t._v("readState>0ï¼Œåˆ™è·å–å†™é”å¤±è´¥ã€‚")]),t._v(" "),s("li",[t._v("writeState>0ï¼Œåˆ™è¿›è¡Œé‡å…¥æ€§åˆ¤æ–­ï¼Œå½“å‰çº¿ç¨‹ä¸æ˜¯é‡å…¥çº¿ç¨‹åˆ™å¤±è´¥ã€‚å¦åˆ™è·å–å†™é”æˆåŠŸã€‚")])])]),t._v(" "),s("li",[t._v("åŒæ­¥çŠ¶æ€ç­‰äº0ï¼Œåˆ™éœ€è¦"),s("strong",[t._v("CAS")]),t._v("å ç”¨é”ã€‚")])]),t._v(" "),s("p",[t._v("å†™é”é‡Šæ”¾é€»è¾‘ä¸ReentrantLocké”é‡Šæ”¾é€»è¾‘ç›¸ä¼¼ã€‚")]),t._v(" "),s("h4",{attrs:{id:"_3-è¯»é”è·å–ä¸é‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-è¯»é”è·å–ä¸é‡Šæ”¾"}},[t._v("#")]),t._v(" 3.è¯»é”è·å–ä¸é‡Šæ”¾")]),t._v(" "),s("p",[t._v("è¯»é”è·å–é€»è¾‘ï¼šåªè¦å†™çŠ¶æ€ä¸º0ï¼Œè¯»çŠ¶æ€å¤§äº0ï¼Œåˆ™è¯»é”æ€»ä¼šè¢«æˆåŠŸè·å–ã€‚"),s("strong",[t._v("å¦å¤–å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”ï¼Œé‚£ä¹ˆå½“ä»–å°è¯•è·å–è¯»é”æ—¶ï¼Œä¹Ÿèƒ½æˆåŠŸè·å–(é™çº§)")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("è¯»åŒæ­¥çŠ¶æ€æŒ‡çš„æ˜¯ï¼Œæ‰€æœ‰è¯»çº¿ç¨‹é‡å…¥è¯»é”çš„æ¬¡æ•°ä¹‹å’Œã€‚æ¯ä¸ªçº¿ç¨‹å•ç‹¬ç»´æŠ¤ä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œä¿å­˜å½“å‰çº¿ç¨‹é‡å…¥çš„æ¬¡æ•°ä¹‹å’Œã€‚")]),t._v(" "),s("p",[t._v("è¯»é”é‡Šæ”¾ä¸ReentrantLocké‡Šæ”¾ç±»ä¼¼ï¼Œéœ€è¦CASæ§åˆ¶å¹¶å‘ã€‚")]),t._v(" "),s("h4",{attrs:{id:"_4-é”é™çº§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-é”é™çº§"}},[t._v("#")]),t._v(" 4.é”é™çº§")]),t._v(" "),s("p",[t._v("é”é™çº§æŒ‡çš„æ˜¯å¹¶å‘æƒ…å†µä¸€ç§æ•°æ®å¯è§æ€§æ§åˆ¶ç­–ç•¥ï¼Œé€‚ç”¨äºç‰¹å®šçš„åœºæ™¯ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("è·å–æŒæœ‰å†™é”")]),t._v(" "),s("li",[s("strong",[t._v("å°è¯•è·å–è¯»é”")])]),t._v(" "),s("li",[t._v("é‡Šæ”¾å†™é”")])]),t._v(" "),s("p",[t._v("å…¶ä¸­ä¸­é—´è¿™ä¸€æ­¥è·å–è¯»é”ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ã€‚å½“å‰çº¿ç¨‹é‡Šæ”¾å†™é”åè¿˜æŒæœ‰è¯»é”ï¼Œè¿™ä½¿å¾—å…¶å®ƒé˜»å¡åœ¨å†™é”çš„çº¿ç¨‹ä»ç„¶å¤„äºè¢«é˜»å¡çš„çŠ¶æ€ã€‚"),s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("ç›¸å½“äºå»¶é•¿äº†å½“å‰çº¿ç¨‹å¯¹æ•°æ®ä¸€è‡´æ€§çš„æ§åˆ¶å‘¨æœŸ")])]),t._v("ã€‚")],1),t._v(" "),s("h2",{attrs:{id:"locksupportå·¥å…·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#locksupportå·¥å…·"}},[t._v("#")]),t._v(" LockSupportå·¥å…·")]),t._v(" "),s("p",[t._v("å®šä¹‰äº†ä¸€ç»„å…¬å…±é™æ€æ–¹æ³•ï¼Œç”¨äºæ§åˆ¶çº¿ç¨‹é˜»å¡å’Œå”¤é†’ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("æ–¹æ³•åç§°")]),t._v(" "),s("th",[t._v("æè¿°")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("park()")]),t._v(" "),s("td",[t._v("é˜»å¡å½“å‰çº¿ç¨‹")])]),t._v(" "),s("tr",[s("td",[t._v("unpark(thread)")]),t._v(" "),s("td",[t._v("å”¤é†’å¤„äºé˜»å¡çŠ¶æ€çš„threadçº¿ç¨‹")])]),t._v(" "),s("tr",[s("td",[t._v("parkNanos(blocker,nanos)")]),t._v(" "),s("td",[t._v("blockeræ ‡è¯†å½“å‰çº¿ç¨‹é˜»å¡å¯¹è±¡")])])])]),t._v(" "),s("h2",{attrs:{id:"conditionæ¥å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conditionæ¥å£"}},[t._v("#")]),t._v(" Conditionæ¥å£")]),t._v(" "),s("p",[t._v("ç›‘è§†å™¨æ–¹æ³•ç”¨äº"),s("strong",[t._v("åœ¨é”åŒæ­¥å—å†…å®ç°çº¿ç¨‹çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶")]),t._v("ï¼Œç›®å‰æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Objectå¯¹è±¡çš„ç›‘è§†å™¨æ–¹æ³•ï¼šwaitï¼Œnotify,\tnotifyAllã€‚ä¸synchronizedé…åˆ")]),t._v(" "),s("li",[t._v("Conditionæ¥å£ç›‘è§†å™¨æ–¹æ³•ï¼šawaitã€‚ä¸Lock.locké…åˆ")])]),t._v(" "),s("h3",{attrs:{id:"æ¥å£ç¤ºä¾‹-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¥å£ç¤ºä¾‹-2"}},[t._v("#")]),t._v(" æ¥å£ç¤ºä¾‹")]),t._v(" "),s("p",[t._v("Conditionå¯¹è±¡åœ¨"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("await()")])]),t._v("é˜»å¡å’Œ"),s("font",{staticStyle:{background:"rgb(240, 240, 236)"},attrs:{color:"#d94a33"}},[s("strong",[t._v("signal()")])]),t._v("é€šçŸ¥çº¿ç¨‹æ—¶ï¼Œå¿…é¡»å…ˆè·å–ä¸å…¶ç»‘å®šçš„Locké”å¯¹è±¡ã€‚")],1),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Condition")]),t._v(" condition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCondition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("conditionAwaitOrSignal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        condition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//é˜»å¡å½“å‰çº¿ç¨‹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//condition.signal(); å…¶å®ƒçº¿ç¨‹è°ƒç”¨å”¤é†’å½“å‰çº¿ç¨‹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("å’Œå…ˆå‰ç­‰å¾…é€šçŸ¥æœºåˆ¶çš„ä¸‰æ®µå¼ç›¸åŒï¼Œ"),s("font",{staticStyle:{background:"rgb(255, 240, 102)"}},[s("strong",[t._v("é˜»å¡ä»£ç éœ€è¦ä½¿ç”¨whileè€Œä¸æ˜¯ifï¼Œé˜²æ­¢è¿‡æ—©æˆ–è€…æ„å¤–é€šçŸ¥")])]),t._v("ã€‚")],1),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" addCondition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"æºç åˆ†æ-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æºç åˆ†æ-2"}},[t._v("#")]),t._v(" æºç åˆ†æ")]),t._v(" "),s("p",[t._v("ConditionObjectæ˜¯AQSåŒæ­¥å™¨çš„å†…éƒ¨ç±»ï¼Œæ¯ä¸ªConditionå¯¹è±¡éƒ½ç»´æŠ¤ä¸€ä¸ªFIFOâ€œç­‰å¾…é˜Ÿåˆ—â€ï¼Œ"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯åœ¨è¯¥Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹")])]),t._v("ã€‚")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20231017/image.4xqzu2ajw380.webp",alt:""}})]),t._v(" "),s("p",[t._v("åœ¨AQSåŒæ­¥å™¨+Conditionæ¨¡å‹çš„ç›‘è§†å™¨æ¨¡å‹ä¸­åŒ…å«ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸€ä¸ªAQSåŒæ­¥é˜Ÿåˆ—")]),t._v(" "),s("li",[t._v("å¤šä¸ªConditionç­‰å¾…é˜Ÿåˆ—")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/blage-coding/picx-images-hosting@master/20231017/image.11vjnxldytwg.webp",alt:""}})]),t._v(" "),s("p",[t._v("åº•å±‚æ— è®ºæ˜¯awaitæ–¹æ³•ï¼Œè¿˜æ˜¯signalæ–¹æ³•ï¼Œéƒ½ç”¨åˆ°äº†"),s("strong",[t._v("LockSupport")]),t._v("è¿›è¡Œé˜»å¡å’Œå”¤é†’èŠ‚ç‚¹çº¿ç¨‹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("await()ï¼šçº¿ç¨‹è¢«Condition.awaitæ–¹æ³•é˜»å¡æ—¶ï¼Œç›¸å½“äºå°†å½“å‰çº¿ç¨‹ä»AQSåŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ï¼Œç§»åŠ¨åˆ°äº†Conditionç­‰å¾…é˜Ÿåˆ—å½“ä¸­ã€‚")]),t._v(" "),s("li",[t._v("signal()ï¼šä»Conditionç­‰å¾…é˜Ÿåˆ—å¤´èŠ‚ç‚¹ç§»é™¤ï¼ŒåŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚å†ä½¿ç”¨LockSupportå”¤é†’(è·³å‡ºawaitæ–¹æ³•çš„whileå¾ªç¯)ï¼Œç»§ç»­è¿›è¡Œé”çš„ç«äº‰ã€‚")]),t._v(" "),s("li",[t._v("signalAll()ï¼šæ‰€æœ‰ç­‰å¾…é˜Ÿåˆ—çš„èŠ‚ç‚¹éƒ½æ‰§è¡Œä¸€æ¬¡signalï¼Œç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚")])])])}),[],!1,null,null,null);s.default=r.exports}}]);
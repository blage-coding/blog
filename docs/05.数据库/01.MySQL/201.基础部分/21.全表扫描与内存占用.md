---
title: 全表扫描与内存占用
date: 2023-07-08 21:31:55
permalink: /pages/1b68b4/
categories:
  - 数据库
  - MySQL
  - 基础部分
tags:
  - 数据库
author: 
  name: phan
  link: https://gitee.com/blage-coding
---
# 全表扫描与内存占用

::: warning
内存只有100G，要对磁盘里一张200G的表进行全表扫描，内存会不会爆？
:::

结论：MySQL的策略是“<font color="red">**边读边发**</font>”。表数据会分段发给客户端，服务端buffer被阻塞就暂停发送。

1. server层每次读取一行记录，并放到MySQL内存<font style="background: rgb(240, 240, 236)" color="#d94a33">net_buffer</font>中，当<font style="background: rgb(240, 240, 236)" color="#d94a33">net_buffer</font>写满后调用网络接口发送出去。
2. 发送函数会将<font style="background: rgb(240, 240, 236)" color="#d94a33">net_buffer</font>的内容写到<font style="background: rgb(240, 240, 236)" color="#d94a33">socket send buffer</font>本地网络栈，然后发送到客户端。如果发送函数返回**EAGAIN**或**WASEWOULDBLOCK**，则说明<font style="background: rgb(240, 240, 236)" color="#d94a33">socket send buffer</font>写满了，进入等待，然后重新发送。

![](https://cdn.staticaly.com/gh/blage-coding/picx-images-hosting@master/20230708/image.4hm5meepw9o0.webp)